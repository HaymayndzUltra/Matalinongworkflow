[
  {
    "id": "face_scan_actionable_20250116",
    "description": "Actionable plan for backend-only face scan implementation compiled from organize.md (frozen source).",
    "todos": [
      {
        "text": "PHASE 0: SETUP & PROTOCOL (READ FIRST)\n\n**Explanations:** This phase establishes the foundational understanding and constraints for the backend-only face scan implementation. We will set up the development environment, review all protocol directives, and ensure we understand the scope constraints: backend-only modifications, no edits to `src/web/mobile_kyc.html`, creation/modification limited to specific modules (`src/api/app.py`, `src/api/contracts.py`, `src/config/threshold_manager.py`, and new `src/face/*` modules). We'll also review privacy requirements (no raw PII/images in logs unless DEBUG explicitly enabled) and CORS/HTTPS exposure requirements.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 0`\n\nIMPORTANT NOTE: Backend-only edits are enforced; feature flags are allowed; all phase gates must pass before proceeding to next phase. Documentation must be created for post-review/pre-analysis stages.",
        "done": true
      },
      {
        "text": "PHASE 1: CONTRACTS & STATIC MOUNT SCAFFOLDING\n\n**Explanations:** In this phase, we add Pydantic models for face scan APIs, define all necessary contracts for the face scanning endpoints, and mount the `/web` path for static file serving without making any UI changes. This establishes the API structure and ensures OpenAPI documentation properly exposes the new endpoints.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 1`\n\nIMPORTANT NOTE: No breaking changes to existing endpoints are permitted. All new contracts must compile successfully and OpenAPI must properly expose all new endpoints.",
        "done": true
      },
      {
        "text": "PHASE 2: THRESHOLD MANAGER (STRICT FACE GATES)\n\n**Explanations:** Implementation of the threshold management system with strict face gates. We'll add comprehensive thresholds including bbox_fill, centering, pose, Tenengrad@640w, brightness (mean/p05/p95), stability milliseconds, PAD minimum, burst caps, and match thresholds. All values must be validated and environment overrides must be properly documented.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 2`\n\nIMPORTANT NOTE: Explicit names are required for all thresholds; validation and bounds must be strictly enforced with no exceptions.",
        "done": true
      },
      {
        "text": "PHASE 3: GEOMETRY & GATING LIBRARY\n\n**Explanations:** Create `src/face/geometry.py` containing pure functions for occupancy calculation, centering evaluation, pose assessment, brightness analysis, Tenengrad sharpness computation, and stability measurements. All functions must provide reasoned failures with deterministic outputs and comprehensive unit tests.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 3`\n\nIMPORTANT NOTE: No I/O side effects are allowed in any geometry functions. All functions must be pure with deterministic outputs.",
        "done": true
      },
      {
        "text": "PHASE 4: /face/lock/check ENDPOINT\n\n**Explanations:** Implement the `/face/lock/check` endpoint that evaluates lock conditions using geometry calculations and thresholds. The endpoint must require continuous pass for at least 900ms (UI runs 600ms countdown after lock). Response format must include {ok, lock, reasons[], thresholds{}} with performance target of ≤20ms typical response time.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 4`\n\nIMPORTANT NOTE: No images are accepted by this endpoint; implementation must be rate limit safe.",
        "done": false
      },
      {
        "text": "PHASE 5: PASSIVE PAD PRE-GATE\n\n**Explanations:** Implement `POST /face/pad/pre` endpoint using PAD (Presentation Attack Detection) detector with spoof heuristics including moiré pattern detection, flat texture analysis, and uniform glare detection. The system must block when score <0.70 or when spoof_high flag is triggered. Returns passive_score and spoof flags that must be respected by the UI.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 5`\n\nIMPORTANT NOTE: Images must be handled transiently with no persistence; all image data must be cleared from memory after processing.",
        "done": false
      },
      {
        "text": "PHASE 6: CHALLENGE SEQUENCER (VALIDATION)\n\n**Explanations:** Create `src/face/challenges.py` and implement `/face/challenge/script` endpoint (picks 2 actions with TTL ≤7s) and `/face/challenge/verify` endpoint (performs EAR/MAR/yaw/time checks). Each action must complete within ≤3.5s and system must cancel on pose or brightness breach.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 6`\n\nIMPORTANT NOTE: Deterministic outcomes with clear reasons are mandatory for all challenge verifications.",
        "done": false
      },
      {
        "text": "PHASE 7: BURST UPLOAD & STORAGE POLICY\n\n**Explanations:** Implement `/face/burst/upload` endpoint supporting ≤24 frames within ≤3.5s using transient storage (RAM/tmpfs). Must include EXIF stripping and auto-deletion post-evaluation. Enforced limits must be respected and cleanup must occur even on errors.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 7`\n\nIMPORTANT NOTE: No gallery writes permitted; no long-term storage allowed; all data must be transient.",
        "done": false
      },
      {
        "text": "PHASE 8: CONSENSUS & BIOMETRICS EVAL\n\n**Explanations:** Create `src/face/consensus.py` to filter blur/glare/pose failures, select top-k=5 frames, match against ID photo with median≥0.62, require ≥3 frames≥0.58, and reject if any top-k <0.58. Implement `/face/burst/eval` endpoint returning {match_score, consensus_ok, frames_used, topk_scores[]}.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 8`\n\nIMPORTANT NOTE: FAR target ~1% must be maintained; all thresholds must be configurable via ThresholdManager.",
        "done": false
      },
      {
        "text": "PHASE 9: DECISION MAPPING (FACE COMPONENT)\n\n**Explanations:** Implement `/face/decision` endpoint that maps passive score, challenges_passed, consensus_ok, and match_score to approve/review/deny decisions with clear reasons. Must auto-deny on liveness_fail, consensus_fail, or spoof_high conditions. Include human-readable reasons and policy_version snapshot in responses.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 9`\n\nIMPORTANT NOTE: No PII permitted in decision logs; only anonymized metrics and decision reasons.",
        "done": false
      },
      {
        "text": "PHASE 10: TELEMETRY & /metrics\n\n**Explanations:** Implement `POST /face/telemetry` for tracking FACE_SEARCHING, FACE_LOCK, COUNTDOWN_START/STOP, BURST_START/END, CHALLENGE_ISSUED/PASSED/FAILED, LIVENESS_PASS/FAIL, MATCH_SCORE, CONSENSUS_OK, and FACE_DONE events. Create `/metrics` endpoint exposing time_to_lock_ms, cancel_rate, challenge_success_rate, median_match_score, and passive_pad_fmr/fnmr aggregates.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 10`\n\nIMPORTANT NOTE: Respect privacy requirements; no raw images in telemetry; aggregates only with device model if available.",
        "done": false
      },
      {
        "text": "PHASE 11: PRIVACY & WORM AUDIT\n\n**Explanations:** Enforce comprehensive privacy measures including no gallery storage, EXIF stripping, and redacted logs. Implement WORM (Write Once Read Many) audit snapshot system capturing thresholds used and decision rationale. Audit entries must be written with documented retention policy.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 11`\n\nIMPORTANT NOTE: Store policy snapshot and metrics only; no raw biometric data in audit logs.",
        "done": false
      },
      {
        "text": "PHASE 12: ACCEPTANCE CRITERIA & VALIDATION\n\n**Explanations:** Validate all performance targets: Lock p50 ≤1.2s, p95 ≤2.5s; countdown ≥600ms; cancel-on-jitter <50ms; challenge pass-rate ≥95% (good light); TAR@FAR1% ≥0.98 (eval set); PAD FMR ≤1%, FNMR ≤3%. Generate comprehensive report with metrics and propose threshold adjustments if gaps exist.\n\n**Concluding Step: Phase Completion Protocol**\n- `python3 todo_manager.py show face_scan_actionable_20250116`\n- `python3 todo_manager.py done face_scan_actionable_20250116 12`\n\nIMPORTANT NOTE: Use ThresholdManager for all adjustments; no hardcoding of thresholds in code is permitted.",
        "done": false
      }
    ],
    "status": "in_progress",
    "created": "2025-01-16T14:30:00+08:00",
    "updated": "2025-08-15T18:36:15.368822+08:00"
  }
]