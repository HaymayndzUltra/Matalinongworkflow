---
--- existing code ...
---
## Phase Gates (Pre-Execution Checks)

Before executing a phase or marking it done, enforce the following gates:

1. Gate: Next-Phase Integrity (Required)
   - Run: `python3 plan_next.py`
   - Verify:
     - The reported next phase matches expectation (index and title)
     - "IMPORTANT NOTE:" is present for that phase
     - Lint MUST NOT report: "Phase 0 is not first" or missing IMPORTANT NOTE
     - Note: Ignore "Completion is non-monotonic (undone after done)" during normal forward progress

2. Gate: Hierarchy Consistency (Recommended)
   - Run: `python3 plain_hier.py <task_id ReplaceAll>`
   - Verify:
     - Progress counters are correct
     - Phase list aligns with plan
     - Command preview matches the intended actions

Only after passing these gates should `todo_manager.py exec` or `done` be performed.