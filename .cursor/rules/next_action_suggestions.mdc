---
description: Automatic next-step trigger suggestions after actions
alwaysApply: true
---

## Post-Action Next-Step Suggestions (Required)

Goal: After every action the assistant performs (validate, show, exec, done), the assistant MUST immediately suggest the most appropriate next TRIGGER PHRASE so the user never has to search for it.

### General Policy
- Always end responses with a single-line suggestion:
  - Format: `Suggested next trigger: <trigger phrase>`
  - If multiple options are contextually valid, list the primary then an alternate on the next line starting with `Alternate:`.
- Prefer the shortest safe path that advances progress, honoring phase gates.
- Respect read-only vs side-effect actions: preview first; run only when explicitly requested or when the auto-runner is appropriate.

### Mappings by Last Action (Gate-Aware)
- After running plan validation (execution mode):
  - `Suggested next trigger: "Show hierarchy"`
  - `Alternate: "Execute the next unfinished phase"`

- After showing hierarchy:
  - Suggest the auto phase runner to handle preview → run → show → done → re-validate.
  - `Suggested next trigger: "Execute the next unfinished phase"`

- After previewing a sub-step (no run):
  - Suggest running the step or returning to plan view.
  - `Suggested next trigger: "Execute the next unfinished phase"`
  - `Alternate: "I-validate ang plan"`

- After executing a sub-step (run):
  - If execution was blocked by Deep Analysis Gate:
    - If the block message contains "No analysis found" or "missing source_task_id":
      - `Suggested next trigger: "Regenerate analysis mirror"`
      - `Alternate: "Start pre-execution analysis"`
    - Else if the block includes "Decision Gate:" or analysis findings (e.g., "CONFLICT", "OVERLAP", "DUPLICATE"):
      - `Suggested next trigger: "Compile analysis doc (strict)"`
      - `Alternate: "Start pre-execution analysis"`
  - Else:
    - `Suggested next trigger: "Tapusin ang phase <K>"`
    - `Alternate: "Ano ang next phase?"`

- After marking a phase done:
  - If analysis mirror looks stale (execution progressed beyond last analysis done:true index):
    - `Suggested next trigger: "Regenerate analysis mirror"`
    - `Alternate: "Start pre-execution analysis"`
  - Else:
    - `Suggested next trigger: "I-validate ang plan"`
    - `Alternate: "Execute the next unfinished phase"`

- After plan ingestion is finalized (JSON approved):
  - Always refresh the analysis mirror to avoid stale gate blocks:
  - `Suggested next trigger: "Regenerate analysis mirror"`
  - `Alternate: "Start pre-execution analysis"`

- After "Compile analysis doc (strict)":
  - If the rendered doc indicates PASS for all phases (e.g., STRICT ANALYSIS SUMMARY has no FAIL and `BLOCKERS:` is empty or `None`):
    - `Suggested next trigger: "I-validate ang plan"`
    - `Alternate: "Show hierarchy"`
  - If the rendered doc indicates BLOCK/FAIL (e.g., contains `BLOCK EXECUTION:` or any FAIL in STRICT ANALYSIS SUMMARY):
    - `Suggested next trigger: "Start pre-execution analysis"`
    - `Alternate: "Compile analysis doc (strict)"`

### Deep Analysis Awareness (if enabled)
- If a Deep Analysis Gate is in effect and currently BLOCK:
  - Suggest analysis-inspection triggers instead of execution.
  - `Suggested next trigger: "Start pre-execution analysis"`
  - `Alternate: "Compile analysis doc (strict)"`

Notes:
- Replace `<K>` with the current phase index when available.
- Keep suggestions concise; use the exact lines above without extra prose between them.

