[
  {
    "id": "face_backend_actionable_20250815",
    "description": "AI-2 Face Backend plan (endpoints, thresholds, PAD, burst/consensus, decision, telemetry, privacy) compiled from organizer.",
    "status": "in_progress",
    "created": "2025-08-15T06:30:00+08:00",
    "updated": "2025-08-15T06:30:00+08:00",
    "todos": [
      { "text": "PHASE 0: SETUP & PROTOCOL (READ FIRST)\n\nExplanations:\n- Scope: Backend-only implementation for face scan flow. No edits to `src/web/mobile_kyc.html`. Provide endpoints, scoring, telemetry, privacy/audit, and thresholds. Mount any new static UI at /web, but do not alter AI‑1 files.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 0\n```\nIMPORTANT NOTE:\n- Backend-only: edit `src/api/app.py`, `src/api/contracts.py`, `src/config/threshold_manager.py`, create `src/face/*`.\n- Expose CORS/HTTPS; never log raw PII/images unless DEBUG explicitly enabled.\n- All phases must pass gates: plan_next Lint ok; docs present.", "done": false },
      { "text": "PHASE 1: CONTRACTS & STATIC MOUNT SCAFFOLDING\n\nExplanations:\n- Add Pydantic models for face scan; define API contracts; mount /web (no UI edits).\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 1\n```\nIMPORTANT NOTE:\n- No breaking changes to existing endpoints; feature-flag exposure allowed.", "done": false },
      { "text": "PHASE 2: THRESHOLD MANAGER (STRICT FACE GATES)\n\nExplanations:\n- Add face thresholds: bbox_fill, centering, pose, Tenengrad, brightness, stability, PAD min, burst caps, match thresholds.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 2\n```\nIMPORTANT NOTE:\n- Thresholds validated, env-overridable.", "done": false },
      { "text": "PHASE 3: GEOMETRY & GATING LIBRARY\n\nExplanations:\n- Create `src/face/geometry.py` for occupancy, centering, pose, brightness stats, Tenengrad@640w, stability; with reasons.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 3\n```\nIMPORTANT NOTE:\n- Deterministic, unit-testable functions.", "done": false },
      { "text": "PHASE 4: /face/lock/check ENDPOINT\n\nExplanations:\n- Implement lock evaluation using thresholds + geometry; require continuous pass ≥900 ms; UI handles 600 ms countdown after lock:true.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 4\n```\nIMPORTANT NOTE:\n- Respond with {ok, lock, reasons[], thresholds{}}; no images.", "done": false },
      { "text": "PHASE 5: PASSIVE PAD PRE-GATE\n\nExplanations:\n- `POST /face/pad/pre` using PAD detector; compute passive score; spoof heuristics; block when <0.70 or spoof_high.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 5\n```\nIMPORTANT NOTE:\n- Return passive_score, spoof_flags; do not save images by default.", "done": false },
      { "text": "PHASE 6: CHALLENGE SEQUENCER (VALIDATION)\n\nExplanations:\n- `src/face/challenges.py`; endpoints: `/face/challenge/script` (2 actions; ≤7s) and `/face/challenge/verify` (EAR/MAR/yaw/time checks).\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 6\n```\nIMPORTANT NOTE:\n- Timeouts: per action ≤3.5s; total ≤7s; cancel on pose/brightness breach.", "done": false },
      { "text": "PHASE 7: BURST UPLOAD & STORAGE POLICY\n\nExplanations:\n- `/face/burst/upload`: ≤24 frames/≤3.5s; transient storage (RAM/tmpfs); strip EXIF; no gallery writes.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 7\n```\nIMPORTANT NOTE:\n- Enforce caps; redact metadata; auto-delete post‑eval.", "done": false },
      { "text": "PHASE 8: CONSENSUS & BIOMETRICS EVAL\n\nExplanations:\n- `src/face/consensus.py`: filter bad frames; top‑k=5; match vs ID photo; median≥0.62; ≥3 frames≥0.58; no top‑k <0.58.\n- Endpoint: `/face/burst/eval`.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 8\n```\nIMPORTANT NOTE:\n- Return {match_score, consensus_ok, frames_used, topk_scores[]}.", "done": false },
      { "text": "PHASE 9: DECISION MAPPING (FACE)\n\nExplanations:\n- `/face/decision`: map passive score, challenges_passed, consensus_ok, match_score to approve/review/deny with reasons.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 9\n```\nIMPORTANT NOTE:\n- Provide human‑readable reasons and policy_version snapshot.", "done": false },
      { "text": "PHASE 10: TELEMETRY & /metrics\n\nExplanations:\n- `POST /face/telemetry`; `/metrics` gauges: time_to_lock_ms, cancel_rate, challenge_success_rate, median_match_score, passive_pad_fmr/fnmr.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 10\n```\nIMPORTANT NOTE:\n- No PII in telemetry; aggregate only.", "done": false },
      { "text": "PHASE 11: PRIVACY & WORM AUDIT\n\nExplanations:\n- No gallery writes; EXIF strip; redact logs by default; WORM audit record including thresholds & decision rationale.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 11\n```\nIMPORTANT NOTE:\n- Store only policy snapshot + metrics; auto-delete burst frames post‑eval.", "done": false },
      { "text": "PHASE 12: ACCEPTANCE CRITERIA & VALIDATION\n\nExplanations:\n- Validate targets: Lock p50 ≤1.2s, p95 ≤2.5s; countdown ≥600ms; cancel‑on‑jitter <50ms; challenge pass‑rate ≥95% (good light); TAR@FAR1% ≥0.98; PAD FMR ≤1%, FNMR ≤3%.\n- Expose metrics on `/metrics`; document results.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 12\n```\nIMPORTANT NOTE:\n- Record deviations; propose threshold adjustments via ThresholdManager (no hardcoding).",
        "done": false
      }
    ]
  }
]