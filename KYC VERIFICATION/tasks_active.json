[
  {
    "id": "face_backend_actionable_20250815",
    "description": "AI-2 Face Backend plan (endpoints, thresholds, PAD, burst/consensus, decision, telemetry, privacy) compiled from organizer.",
    "status": "in_progress",
    "created": "2025-08-15T06:35:00+08:00",
    "updated": "2025-08-15T06:35:00+08:00",
    "todos": [
      {
        "text": "PHASE 0: SETUP & PROTOCOL (READ FIRST)\n\nExplanations:\n- Scope: Backend-only implementation for face scan flow. No edits to `src/web/mobile_kyc.html`. Provide endpoints, scoring, telemetry, privacy/audit, and thresholds. Mount any new static UI at `/web`, but do not alter AI‑1 files.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 0\n```\nIMPORTANT NOTE:\n- Backend-only: edit `src/api/app.py`, `src/api/contracts.py`, `src/config/threshold_manager.py`, and create `src/face/*`.\n- Expose CORS/HTTPS; do not log raw PII/images unless DEBUG explicitly enabled.\n- All phases must pass gates: plan_next Lint ok; postreview & preanalysis docs present.",
        "done": false
      },
      {
        "text": "PHASE 1: CONTRACTS & STATIC MOUNT SCAFFOLDING\n\nExplanations:\n- Add Pydantic models for face scan payloads; define API contracts; mount `/web` for AI‑1 page (no UI edits).\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 1\n```\nIMPORTANT NOTE:\n- No breaking changes to existing endpoints; feature-flag exposure is allowed.",
        "done": false
      },
      {
        "text": "PHASE 2: THRESHOLD MANAGER (STRICT FACE GATES)\n\nExplanations:\n- Add face thresholds: bbox_fill, centering, pose limits, Tenengrad focus, brightness mean/p05/p95, stability ms, PAD min, burst caps, match thresholds.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 2\n```\nIMPORTANT NOTE:\n- All threshold names explicit and validated; env var overrides required.",
        "done": false
      },
      {
        "text": "PHASE 3: GEOMETRY & GATING LIBRARY\n\nExplanations:\n- Create `src/face/geometry.py` for occupancy, centering, pose (yaw/pitch/roll), brightness stats, Tenengrad@640w, stability windows. Return reasons for any gate failure.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 3\n```\nIMPORTANT NOTE:\n- Deterministic, side‑effect free; unit-testable functions.",
        "done": false
      },
      {
        "text": "PHASE 4: /face/lock/check ENDPOINT\n\nExplanations:\n- Implement lock evaluation using thresholds + geometry library. Require continuous pass ≥900 ms; UI will handle the 600 ms countdown after lock:true.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 4\n```\nIMPORTANT NOTE:\n- Respond with `{ ok, lock, reasons[], thresholds{} }`; no image uploads here.",
        "done": false
      },
      {
        "text": "PHASE 5: PASSIVE PAD PRE‑GATE\n\nExplanations:\n- Add `POST /face/pad/pre` using `src/liveness/pad_detector.py`; compute passive score; detect spoof heuristics (moiré, flat textures, uniform glare). Block when score < 0.70 or spoof_high.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 5\n```\nIMPORTANT NOTE:\n- Return `passive_score`, `spoof_flags`; do not save images by default.",
        "done": false
      },
      {
        "text": "PHASE 6: CHALLENGE SEQUENCER (VALIDATION)\n\nExplanations:\n- Add `src/face/challenges.py`; endpoints: `POST /face/challenge/script` (pick 2 actions; TTL 7s) and `POST /face/challenge/verify` (validate EAR/MAR/yaw deltas/time).\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 6\n```\nIMPORTANT NOTE:\n- Strict timeouts: per action ≤3.5s; total ≤7s; cancel on pose/brightness breach.",
        "done": false
      },
      {
        "text": "PHASE 7: BURST UPLOAD & STORAGE POLICY\n\nExplanations:\n- `POST /face/burst/upload`: accept ≤24 frames/≤3.5s; transient storage only (RAM/tmpfs). Strip EXIF; no gallery writes; auto-delete after eval.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 7\n```\nIMPORTANT NOTE:\n- Enforce size/duration caps; redact metadata; ensure cleanup on error.",
        "done": false
      },
      {
        "text": "PHASE 8: CONSENSUS & BIOMETRICS EVAL\n\nExplanations:\n- `src/face/consensus.py`: filter blur/glare/pose‑fail; choose top‑k=5 frames; compute match vs ID photo; require median ≥ 0.62 and ≥ 3 frames ≥ 0.58; no frame in top‑k < 0.58. Endpoint: `POST /face/burst/eval`.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 8\n```\nIMPORTANT NOTE:\n- Return `{ match_score, consensus_ok, frames_used, topk_scores[] }`; FAR target ~1%.",
        "done": false
      },
      {
        "text": "PHASE 9: DECISION MAPPING (FACE COMPONENT)\n\nExplanations:\n- `POST /face/decision`: map passive score, challenges_passed, consensus_ok, match_score to `approve/review/deny` with reasons. Auto-deny: liveness_fail OR consensus_fail OR spoof_high.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 9\n```\nIMPORTANT NOTE:\n- Provide human‑readable reasons and `policy_version` snapshot.",
        "done": false
      },
      {
        "text": "PHASE 10: TELEMETRY & /metrics\n\nExplanations:\n- `POST /face/telemetry` for FACE_SEARCHING, FACE_LOCK, COUNTDOWN_START/STOP, BURST_START/END, CHALLENGE_ISSUED/PASSED/FAILED, LIVENESS_PASS/FAIL, MATCH_SCORE, CONSENSUS_OK, FACE_DONE. `/metrics` gauges: `time_to_lock_ms`, `cancel_rate`, `challenge_success_rate`, `median_match_score`, `passive_pad_fmr/fnmr`.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 10\n```\nIMPORTANT NOTE:\n- No PII in telemetry; aggregate values only.",
        "done": false
      },
      {
        "text": "PHASE 11: PRIVACY & WORM AUDIT\n\nExplanations:\n- Enforce: no gallery writes; EXIF strip; redact logs by default; WORM audit record including thresholds used and decision rationale (policy snapshot).\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 11\n```\nIMPORTANT NOTE:\n- Store only policy snapshot + metrics; auto-delete burst frames post‑eval.",
        "done": false
      },
      {
        "text": "PHASE 12: ACCEPTANCE CRITERIA & VALIDATION\n\nExplanations:\n- Validate targets: Lock p50 ≤ 1.2s, p95 ≤ 2.5s; countdown ≥ 600ms; cancel‑on‑jitter < 50ms; challenge pass‑rate ≥ 95% (good light); TAR@FAR1% ≥ 0.98 (eval set); passive PAD FMR ≤ 1%, FNMR ≤ 3%. Expose metrics on `/metrics`; document results.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 12\n```\nIMPORTANT NOTE:\n- Record deviations; propose threshold adjustments via `ThresholdManager` (no hardcoding).",
        "done": false
      }
    ]
  }
]